<%= render 'layout/header'%>
<div class="container">
  <div class="row">
<h2>注文情報確認</h2>
<table>
  <th>商品名</th>
  <th>単価(税込)</th>
  <th>数量</th>
  <th>小計</th>
  </tr>
   #合計金額total初期化
   <% total = 0 %>
<% @current_items.each do|cart|%>
  <tr>
          <td>
          <%= attachment_image_tag(cart_item.item, :image, size: "60x50", fallback: "no_image.jpg") %
<%= cart.item.name %>
<% (cart.item.price).tos(:delimited) %>
<%= cart.quantity %> <!-- 個数 -->
<%= (cart.item.price*cart.quantity).to_s(:delimited) %> <!-- 小計 -->
<% subtotal = ((cart_item.item.price*cart_item.quantity)*1.08).to_i %>
                      <!--小計を表示-->
                      <%= subtotal %>
      <!--アイテムごとに合計金額に加算する-->
              <% total += (cart_item.item.price*cart_item.quantity)*1.08 %>
            <% end %>
          </table>
        </div>
        <div class='col-3'>
            <table class="table table-bordered border-dark">
                <% @order.postage = 800 %>
                <tr><th class="table-secondary">送料</th><td><%= @order.postage %></td></tr>
                <tr><th class="table-secondary">商品合計</th><td><%= total.to_i %></td></tr>
                <% @order.total_payment = @order.postage + total.to_i %>
                <tr><th class="table-secondary">請求金額</th><td><%= @order.total_payment %></td></tr>
            </table>
        </div>
    </div>

<p>ご請求金額</p>
<%= @total.to_s(:delimited) %> <!-- お買い物の合計金額 -->
 <tr><th>支払方法</th><td class="col-10"><%= @order.payment_method %></td></tr>
<p>お届け先</p>
<%= @order.shipping_post_code %>
              <%= @order.shipping_post_code %>
                <%= @order.shipping_address %>
                <%= @order.shipping_name %>
                </td></tr>
            </table>
        </div>
    </div>


<%= form_with model: @order, url: orders_path, method: :post, local: true do |f| %>
  <%= f.hidden_field :name %>
  <%= f.hidden_field :address %>
  <%= f.hidden_field :total_price, value: @total %>
  <%= f.submit "注文を確定する" ,class: 'btn btn-success' %>
<% end %>
</div>
</div>