<%= render 'layouts/header', customer: current_customer %>
<div class="container px-5">
  <h2>注文情報確認</h2>
  <div class="row mx-auto">
    <div class="col-8">
      <table class="table table-hover table-inverse table-bordered">
        <thead>
          <tr>
            <th>商品名</th>
            <th>単価（税込み）</th>
            <th>数量</th>
            <th>小計</th>
          </tr>
        </thead>
        <tbody>
          <% @cart_items.each do|cart_item|%>
            <tr>
              <td>
                <%= image_tag cart_item.item.image,size: "150x100" %>
                <span><%= cart_item.item.name %></span>
              </td>
              <td><%= cart_item.item.with_tax_price.to_s(:delimited) %></td>
              <td><%= cart_item.quantity %></td>
              <!--小計の計算-->
              <td><%= ((cart_item.item.with_tax_price)*(cart_item.quantity)).to_s(:delimited) %></td>
              <!--商品合計金額の計算-->
              <% @total_price +=(cart_item.item.with_tax_price)*(cart_item.quantity) %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <div class="col-4">
      <table class="table table-hover table-inverse table-bordered">
        <tr>
          <th>送料</th>
          <td><%= @order.postage %></td>
        </tr>
        <tr>
          <th>商品合計</th>
          <td><%= @total_price.to_s(:delimited) %></td>
        </tr>
        <tr>
          <th>請求金額</th>
          <td><%= (@total_price + @order.postage).to_s(:delimited) %></td>
        </tr>
      </table>
    </div>
  </div>
  <div class="row" >
    <table class="table table-hover table-inverse table-borderless">
      <tr>
        <th>お支払方法</th>
        <td><%= @order.pay_method_i18n %></td>
      </tr>
      <tr>
        <th>お届け先</th>
        <td>〒<%= @order.postcode %><%= @order.address %><%= @order.address_name %></td>
      </tr>
    </table>
  </div>
  <div class="row">
    <%= form_with model: @order, url: orders_path, method: :post do |f| %>
      <%= f.hidden_field :customer_id, :value => @customer.id %>
      <%= f.hidden_field :pay_method, :value => @order.pay_method %>
      <%= f.hidden_field :postcode, :value => @order.postcode %>
      <%= f.hidden_field :address, :value => @order.address %>
      <%= f.hidden_field :address_name, :value => @order.address_name %>
      <%= f.hidden_field :payment, :value => (@total_price + @order.postage) %>
      <%= f.submit "注文を確定する" ,class: 'btn btn-success' %>
    <% end %>
  </div>
</div>